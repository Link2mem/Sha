name: Force Extract from Gofile

on:
  workflow_dispatch:

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Gofile Stealth Download
        run: |
          # محاولة جلب الرابط المباشر من خلال الـ API مع Header متصفح حقيقي
          CONTENT_ID="OskDjd"
          echo "Fetching data for folder $CONTENT_ID..."
          
          # جلب رابط السيرفر والملف
          FILE_INFO=$(curl -s "https://api.gofile.io/contents/$CONTENT_ID")
          DIRECT_LINK=$(echo $FILE_INFO | jq -r '.data.children[0].link')
          
          if [ "$DIRECT_LINK" == "null" ] || [ -z "$DIRECT_LINK" ]; then
            echo "الموقع رفض يعطينا الرابط المباشر. الرد كان: $FILE_INFO"
            exit 1
          fi
          
          echo "لقينا الرابط: $DIRECT_LINK"
          # التحميل مع تزوير الـ User-Agent كأننا متصفح
          curl -L -H "User-Agent: Mozilla/5.0" -o Appsui9.zip "$DIRECT_LINK"

      - name: Extract Specific Folders
        run: |
          unzip -q Appsui9.zip "*Apps/*" "*priv-app/*" -d ./
          rm Appsui9.zip

      - name: Push to Repo
        run: |
          git config --local user.email "Were.aksle@gmail.com"
          git config --local user.name "Link2mem"
          git add .
          git commit -m "Extract from Gofile" || echo "No changes"
          git push
